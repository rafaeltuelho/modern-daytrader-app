# Application Configuration
quarkus.application.name=daytrader-quarkus
quarkus.application.version=1.0.0-SNAPSHOT

# HTTP Configuration
quarkus.http.port=8080

# CORS Configuration - Allow frontend origins
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:5173
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with,origin
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-max-age=24H
quarkus.http.cors.access-control-allow-credentials=true

# REST API Configuration
quarkus.rest.path=/api/v1

# Database Configuration - H2 for Development
%dev.quarkus.datasource.db-kind=h2
%dev.quarkus.datasource.username=daytrader
%dev.quarkus.datasource.password=daytrader
%dev.quarkus.datasource.jdbc.url=jdbc:h2:mem:daytrader;DB_CLOSE_DELAY=-1;MODE=PostgreSQL
%dev.quarkus.hibernate-orm.database.generation=drop-and-create
%dev.quarkus.hibernate-orm.log.sql=true
%dev.quarkus.hibernate-orm.sql-load-script=import-dev.sql
%dev.quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect

# Database Configuration - PostgreSQL for Production
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=daytrader
quarkus.datasource.password=daytrader
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/daytrader
quarkus.datasource.jdbc.max-size=20
quarkus.datasource.jdbc.min-size=5
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=false

# JPA/Hibernate Configuration
quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect
quarkus.hibernate-orm.jdbc.statement-batch-size=20

# Transaction Configuration
quarkus.transaction-manager.default-transaction-timeout=30s

# OpenAPI/Swagger Configuration
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui
quarkus.smallrye-openapi.info-title=DayTrader Quarkus API
quarkus.smallrye-openapi.info-version=1.0.0
quarkus.smallrye-openapi.info-description=Modernized DayTrader REST API built with Quarkus
quarkus.smallrye-openapi.info-contact-name=DayTrader Team

# Health Check Configuration
quarkus.smallrye-health.root-path=/health
quarkus.smallrye-health.liveness-path=/health/live
quarkus.smallrye-health.readiness-path=/health/ready

# Metrics Configuration
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics

# Security Configuration - JWT Authentication
quarkus.smallrye-jwt.enabled=true
mp.jwt.verify.publickey.location=META-INF/resources/publicKey.pem
mp.jwt.verify.issuer=https://daytrader.example.com
smallrye.jwt.sign.key.location=META-INF/resources/privateKey.pem
smallrye.jwt.new-token.issuer=https://daytrader.example.com
smallrye.jwt.new-token.lifespan=3600

# Allow unauthenticated access to public endpoints (login, register, quotes, health, openapi)
# Note: /api/v1/accounts (POST for registration) is protected by @PermitAll annotation
quarkus.http.auth.permission.public.paths=/api/v1/auth/*,/api/v1/quotes/*,/api/v1/market/*,/health/*,/openapi,/swagger-ui/*,/q/*,/api/v1/accounts
quarkus.http.auth.permission.public.policy=permit
quarkus.http.auth.permission.public.methods=GET,POST,OPTIONS

# Protected endpoints require authentication (accounts with ID, portfolio, orders)
quarkus.http.auth.permission.accounts.paths=/api/v1/accounts/*
quarkus.http.auth.permission.accounts.policy=authenticated
quarkus.http.auth.permission.portfolio.paths=/api/v1/portfolio/*,/api/v1/portfolio
quarkus.http.auth.permission.portfolio.policy=authenticated
quarkus.http.auth.permission.orders.paths=/api/v1/orders/*,/api/v1/orders
quarkus.http.auth.permission.orders.policy=authenticated

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."com.ibm.websphere.samples.daytrader".level=DEBUG
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.console.json=false

# Development Mode Configuration
%dev.quarkus.log.level=INFO
%dev.quarkus.hibernate-orm.log.sql=true

# Test Configuration
%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.username=test
%test.quarkus.datasource.password=test
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;MODE=PostgreSQL
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect
%test.quarkus.hibernate-orm.log.sql=false
%test.quarkus.log.category."org.hibernate".level=WARN
